<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SMC Sanitation Safety Command Center | Solapur</title>
    <style>
        /* =========================================
           ROOT VARIABLES & RESET
           ========================================= */
        :root {
            --primary: #0056b3; /* SMC Blue */
            --accent: #00d2d3;  /* Cyan for tech feel */
            --danger: #ff6b6b;  /* Red for SOS */
            --warning: #feca57;
            --success: #1dd1a1;
            --dark: #2c3e50;
            --light: #f8f9fa;
            --white: #ffffff;
            --grey: #bdc3c7;
            --shadow-soft: 0 10px 30px rgba(0, 0, 0, 0.05);
            --shadow-hover: 0 15px 35px rgba(0, 0, 0, 0.1);
            --font-main: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            --glass: rgba(255, 255, 255, 0.95);
            --border-radius: 16px;
            --transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            outline: none;
        }

        body {
            font-family: var(--font-main);
            background-color: #f0f2f5; /* Very light grey to contrast white cards */
            color: var(--dark);
            overflow: hidden; /* App-like feel */
            height: 100vh;
            width: 100vw;
        }

        /* Scrollbar Styling */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
        }
        ::-webkit-scrollbar-thumb {
            background: #c1c1c1;
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #a8a8a8;
        }

        /* =========================================
           LOADER ANIMATION (Intro)
           ========================================= */
        #loader {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--white);
            z-index: 9999;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            transition: opacity 0.8s ease-out, visibility 0.8s;
        }

        .spinner {
            width: 60px;
            height: 60px;
            border: 5px solid var(--light);
            border-top: 5px solid var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }

        .loading-text {
            font-size: 1.2rem;
            color: var(--dark);
            letter-spacing: 2px;
            font-weight: 600;
            animation: pulseText 1.5s infinite ease-in-out;
        }

        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        @keyframes pulseText { 0%, 100% { opacity: 0.6; } 50% { opacity: 1; } }

        /* =========================================
           LAYOUT GRID
           ========================================= */
        .app-container {
            display: grid;
            grid-template-columns: 260px 1fr;
            grid-template-rows: 70px 1fr;
            height: 100vh;
            grid-template-areas:
                "sidebar header"
                "sidebar content";
            opacity: 0; /* Hidden initially for loader */
            transform: scale(0.98);
            transition: opacity 0.6s ease, transform 0.6s ease;
        }

        .app-container.loaded {
            opacity: 1;
            transform: scale(1);
        }

        /* =========================================
           SIDEBAR
           ========================================= */
        .sidebar {
            grid-area: sidebar;
            background: var(--white);
            border-right: 1px solid rgba(0,0,0,0.05);
            display: flex;
            flex-direction: column;
            padding: 20px;
            z-index: 10;
        }

        .logo-area {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 40px;
            padding-left: 10px;
        }

        .logo-icon {
            width: 40px;
            height: 40px;
            background: var(--primary);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 1.2rem;
        }

        .logo-text h1 {
            font-size: 1rem;
            font-weight: 700;
            color: var(--dark);
            line-height: 1.2;
        }
        .logo-text span {
            font-size: 0.75rem;
            color: var(--grey);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .nav-links {
            list-style: none;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .nav-item {
            display: flex;
            align-items: center;
            padding: 12px 15px;
            border-radius: 10px;
            color: var(--dark);
            text-decoration: none;
            transition: var(--transition);
            font-weight: 500;
            cursor: pointer;
        }

        .nav-item svg {
            width: 20px;
            height: 20px;
            margin-right: 15px;
            fill: none;
            stroke: currentColor;
            stroke-width: 2;
            stroke-linecap: round;
            stroke-linejoin: round;
        }

        .nav-item:hover, .nav-item.active {
            background: #eef2ff;
            color: var(--primary);
            transform: translateX(5px);
        }

        .sidebar-footer {
            margin-top: auto;
            padding-top: 20px;
            border-top: 1px solid rgba(0,0,0,0.05);
        }

        .status-card {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 12px;
        }
        .status-card h4 { font-size: 0.8rem; color: var(--grey); margin-bottom: 5px; }
        .status-indicator { display: flex; align-items: center; gap: 8px; font-size: 0.9rem; font-weight: 600; }
        .dot { width: 8px; height: 8px; border-radius: 50%; background: var(--success); box-shadow: 0 0 0 3px rgba(29, 209, 161, 0.2); }

        /* =========================================
           HEADER
           ========================================= */
        .header {
            grid-area: header;
            background: var(--white);
            border-bottom: 1px solid rgba(0,0,0,0.05);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 30px;
            z-index: 5;
        }

        .header-title h2 {
            font-size: 1.5rem;
            font-weight: 700;
        }
        .header-title p {
            font-size: 0.9rem;
            color: var(--grey);
        }

        .header-controls {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .search-bar {
            background: var(--light);
            padding: 10px 20px;
            border-radius: 30px;
            display: flex;
            align-items: center;
            width: 300px;
            transition: var(--transition);
        }
        .search-bar:focus-within { box-shadow: 0 0 0 2px rgba(0, 86, 179, 0.1); }
        .search-bar input {
            border: none;
            background: transparent;
            margin-left: 10px;
            width: 100%;
            font-size: 0.9rem;
        }

        .btn-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: none;
            background: var(--light);
            cursor: pointer;
            position: relative;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .btn-icon:hover { background: #e2e6ea; transform: translateY(-2px); }
        .badge {
            position: absolute;
            top: -2px;
            right: -2px;
            background: var(--danger);
            color: white;
            font-size: 0.65rem;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 2px solid var(--white);
        }

        .user-profile {
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
        }
        .avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid var(--white);
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .user-info { text-align: right; }
        .user-info strong { display: block; font-size: 0.9rem; }
        .user-info span { font-size: 0.75rem; color: var(--grey); }

        /* =========================================
           MAIN CONTENT DASHBOARD
           ========================================= */
        .content {
            grid-area: content;
            padding: 30px;
            overflow-y: auto;
            display: grid;
            grid-template-columns: 2.5fr 1fr;
            grid-template-rows: auto 1fr auto;
            gap: 25px;
            height: 100%;
        }

        /* KPI Cards */
        .kpi-row {
            grid-column: 1 / -1;
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
        }

        .card {
            background: var(--white);
            border-radius: var(--border-radius);
            padding: 20px;
            box-shadow: var(--shadow-soft);
            transition: var(--transition);
            position: relative;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-hover);
        }

        .card-icon-bg {
            position: absolute;
            top: -10px;
            right: -10px;
            width: 80px;
            height: 80px;
            background: rgba(0,0,0,0.03);
            border-radius: 50%;
            z-index: 0;
        }

        .card-content { position: relative; z-index: 1; }
        .card-title { font-size: 0.85rem; color: var(--grey); font-weight: 600; text-transform: uppercase; margin-bottom: 10px; }
        .card-value { font-size: 2rem; font-weight: 800; color: var(--dark); margin-bottom: 5px; }
        .card-trend { font-size: 0.8rem; display: flex; align-items: center; gap: 5px; }
        .trend-up { color: var(--success); }
        .trend-down { color: var(--danger); }

        /* Main Map Section */
        .map-section {
            grid-column: 1 / 2;
            background: var(--white);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-soft);
            padding: 20px;
            display: flex;
            flex-direction: column;
            position: relative;
            min-height: 400px;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        .section-title { font-size: 1.1rem; font-weight: 700; }

        .map-controls { display: flex; gap: 10px; }
        .map-btn {
            padding: 5px 12px;
            border: 1px solid #eee;
            background: white;
            border-radius: 6px;
            font-size: 0.8rem;
            cursor: pointer;
            transition: var(--transition);
        }
        .map-btn.active { background: var(--primary); color: white; border-color: var(--primary); }

        #cityMap {
            width: 100%;
            height: 100%;
            background: #eef4f8; /* Map water/land color */
            border-radius: 12px;
            position: relative;
            overflow: hidden;
            border: 1px solid #dde6ed;
        }
        
        /* Custom Map Tooltip */
        .map-tooltip {
            position: absolute;
            background: rgba(44, 62, 80, 0.9);
            color: white;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 0.8rem;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.2s;
            z-index: 100;
            transform: translate(-50%, -120%);
        }

        /* Right Side Panel (Health & Feeds) */
        .side-panel {
            grid-column: 2 / 3;
            grid-row: 2 / 4;
            display: flex;
            flex-direction: column;
            gap: 25px;
        }

        .health-monitor {
            background: var(--white);
            border-radius: var(--border-radius);
            padding: 20px;
            box-shadow: var(--shadow-soft);
        }

        .worker-list {
            margin-top: 15px;
            display: flex;
            flex-direction: column;
            gap: 12px;
            max-height: 250px;
            overflow-y: auto;
        }

        .worker-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 10px;
            border: 1px solid #f0f0f0;
            border-radius: 8px;
            transition: var(--transition);
        }
        .worker-item:hover { border-color: var(--accent); background: #fcfcfc; }

        .w-info { display: flex; align-items: center; gap: 10px; }
        .w-img { width: 35px; height: 35px; border-radius: 50%; object-fit: cover; }
        .w-details h5 { font-size: 0.9rem; margin-bottom: 2px; }
        .w-details span { font-size: 0.7rem; color: var(--grey); }

        .vitals { display: flex; flex-direction: column; align-items: flex-end; }
        .vital-row { display: flex; align-items: center; gap: 5px; font-size: 0.75rem; font-weight: 600; }
        .heart-icon { color: var(--danger); animation: heartbeat 1.5s infinite; }

        @keyframes heartbeat { 0% { transform: scale(1); } 15% { transform: scale(1.3); } 30% { transform: scale(1); } 45% { transform: scale(1.15); } 60% { transform: scale(1); } }

        .video-wall {
            background: var(--white);
            border-radius: var(--border-radius);
            padding: 20px;
            box-shadow: var(--shadow-soft);
            flex-grow: 1;
        }

        .video-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            grid-template-rows: 1fr 1fr;
            gap: 10px;
            height: 100%;
            min-height: 250px;
        }

        .video-feed {
            background: #000;
            border-radius: 8px;
            position: relative;
            overflow: hidden;
            border: 2px solid transparent;
        }
        .video-feed img { width: 100%; height: 100%; object-fit: cover; opacity: 0.7; }
        
        .rec-badge {
            position: absolute;
            top: 8px;
            left: 8px;
            background: rgba(255, 0, 0, 0.8);
            color: white;
            font-size: 0.6rem;
            padding: 2px 6px;
            border-radius: 4px;
            display: flex;
            align-items: center;
            gap: 4px;
        }
        .rec-dot { width: 6px; height: 6px; background: white; border-radius: 50%; animation: blink 1s infinite; }
        
        .cam-label {
            position: absolute;
            bottom: 8px;
            left: 8px;
            color: white;
            font-size: 0.7rem;
            background: rgba(0,0,0,0.5);
            padding: 2px 6px;
            border-radius: 4px;
        }

        @keyframes blink { 0%, 100% { opacity: 1; } 50% { opacity: 0; } }

        /* Bottom Panel (Incident Table) */
        .incident-panel {
            grid-column: 1 / 2;
            background: var(--white);
            border-radius: var(--border-radius);
            padding: 20px;
            box-shadow: var(--shadow-soft);
            min-height: 250px;
        }

        .table-container {
            width: 100%;
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.9rem;
        }

        th {
            text-align: left;
            padding: 12px 15px;
            border-bottom: 2px solid #f0f0f0;
            color: var(--grey);
            font-weight: 600;
        }

        td {
            padding: 12px 15px;
            border-bottom: 1px solid #f0f0f0;
            color: var(--dark);
        }

        tr:hover td { background: #fafafa; }

        .status-pill {
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 0.7rem;
            font-weight: 700;
            text-transform: uppercase;
        }
        .status-critical { background: rgba(255, 107, 107, 0.15); color: var(--danger); }
        .status-warning { background: rgba(254, 202, 87, 0.15); color: #e1b12c; }
        .status-resolved { background: rgba(29, 209, 161, 0.15); color: var(--success); }

        /* Toast Notifications */
        .toast-container {
            position: fixed;
            bottom: 30px;
            right: 30px;
            display: flex;
            flex-direction: column;
            gap: 15px;
            z-index: 1000;
        }

        .toast {
            background: var(--white);
            width: 320px;
            padding: 15px;
            border-radius: 12px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.15);
            display: flex;
            align-items: center;
            gap: 15px;
            transform: translateX(120%);
            animation: slideInToast 0.5s forwards;
            border-left: 5px solid var(--primary);
        }

        .toast.warning { border-left-color: var(--warning); }
        .toast.danger { border-left-color: var(--danger); }

        .toast-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #f0f0f0;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }
        .toast-content h4 { font-size: 0.9rem; margin-bottom: 4px; }
        .toast-content p { font-size: 0.8rem; color: var(--grey); }

        @keyframes slideInToast { to { transform: translateX(0); } }
        @keyframes slideOutToast { to { transform: translateX(120%); opacity: 0; } }

        /* SVG Chart Styles */
        .chart-container {
            width: 100%;
            height: 200px;
            position: relative;
            margin-top: 20px;
        }
        .chart-line {
            fill: none;
            stroke: var(--primary);
            stroke-width: 3;
            stroke-linecap: round;
        }
        .chart-area {
            fill: rgba(0, 86, 179, 0.1);
            stroke: none;
        }
        .chart-grid {
            stroke: #eee;
            stroke-width: 1;
        }

        /* Responsive */
        @media (max-width: 1200px) {
            .content { grid-template-columns: 1fr; }
            .map-section { grid-column: 1; grid-row: 2; min-height: 400px; }
            .side-panel { grid-column: 1; grid-row: 3; display: grid; grid-template-columns: 1fr 1fr; }
            .incident-panel { grid-column: 1; grid-row: 4; }
        }
        @media (max-width: 900px) {
            .app-container { grid-template-columns: 80px 1fr; }
            .logo-text, .nav-item span, .sidebar-footer { display: none; }
            .nav-item { justify-content: center; padding: 15px 0; }
            .nav-item svg { margin-right: 0; }
            .side-panel { grid-template-columns: 1fr; }
            .kpi-row { grid-template-columns: repeat(2, 1fr); }
        }
        @media (max-width: 600px) {
            .kpi-row { grid-template-columns: 1fr; }
            .header-controls { display: none; }
        }

    </style>
</head>
<body>

    <!-- Splash Screen Loader -->
    <div id="loader">
        <div class="spinner"></div>
        <div class="loading-text">INITIALIZING SAFETY PROTOCOLS...</div>
    </div>

    <div class="app-container" id="app">
        <!-- SIDEBAR -->
        <nav class="sidebar">
            <div class="logo-area">
                <div class="logo-icon">SMC</div>
                <div class="logo-text">
                    <h1>Solapur</h1>
                    <span>Municipal Corp</span>
                </div>
            </div>

            <ul class="nav-links">
                <li class="nav-item active">
                    <svg viewBox="0 0 24 24"><path d="M3 13h8V3H3v10zm0 8h8v-6H3v6zm10 0h8V11h-8v10zm0-18v6h8V3h-8z"/></svg>
                    <span>Dashboard</span>
                </li>
                <li class="nav-item">
                    <svg viewBox="0 0 24 24"><path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/></svg>
                    <span>Live Tracking</span>
                </li>
                <li class="nav-item">
                    <svg viewBox="0 0 24 24"><path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-7 14h-2v-4H7v-2h3V7h2v4h3v2h-3v4z"/></svg>
                    <span>Health Aid</span>
                </li>
                <li class="nav-item">
                    <svg viewBox="0 0 24 24"><path d="M12 22c1.1 0 2-.9 2-2h-4c0 1.1.9 2 2 2zm6-6v-5c0-3.07-1.63-5.64-4.5-6.32V4c0-.83-.67-1.5-1.5-1.5s-1.5.67-1.5 1.5v.68C7.64 5.36 6 7.92 6 11v5l-2 2v1h16v-1l-2-2zm-2 1H8v-6c0-2.48 1.51-4.5 4-4.5s4 2.02 4 4.5v6z"/></svg>
                    <span>Alerts & SOS</span>
                </li>
                <li class="nav-item">
                    <svg viewBox="0 0 24 24"><path d="M16 6l2.29 2.29-4.88 4.88-4-4L2 16.59 3.41 18l6-6 4 4 6.3-6.29L22 12V6z"/></svg>
                    <span>Analytics</span>
                </li>
                <li class="nav-item">
                    <svg viewBox="0 0 24 24"><path d="M19.43 12.98c.04-.32.07-.64.07-.98s-.03-.66-.07-.98l2.11-1.65c.19-.15.24-.42.12-.64l-2-3.46c-.12-.22-.39-.3-.61-.22l-2.49 1c-.52-.4-1.08-.73-1.69-.98l-.38-2.65C14.46 2.18 14.25 2 14 2h-4c-.25 0-.46.18-.49.42l-.38 2.65c-.61.25-1.17.59-1.69.98l-2.49-1c-.23-.09-.49 0-.61.22l-2 3.46c-.13.22-.07.49.12.64l2.11 1.65c-.04.32-.07.65-.07.98s.03.66.07.98l-2.11 1.65c-.19.15-.24.42-.12.64l2 3.46c.12.22.39.3.61.22l2.49-1c.52.4 1.08.73 1.69.98l.38 2.65c.03.24.24.42.49.42h4c.25 0 .46-.18.49-.42l.38-2.65c.61-.25 1.17-.59 1.69-.98l2.49 1c.23.09.49 0 .61-.22l2-3.46c.12-.22.07-.49-.12-.64l-2.11-1.65zM12 15.5c-1.93 0-3.5-1.57-3.5-3.5s1.57-3.5 3.5-3.5 3.5 1.57 3.5 3.5-1.57 3.5-3.5 3.5z"/></svg>
                    <span>Settings</span>
                </li>
            </ul>

            <div class="sidebar-footer">
                <div class="status-card">
                    <h4>System Status</h4>
                    <div class="status-indicator">
                        <div class="dot"></div>
                        <span>All Systems Operational</span>
                    </div>
                </div>
            </div>
        </nav>

        <!-- HEADER -->
        <header class="header">
            <div class="header-title">
                <h2>Safety Command Center</h2>
                <p>Monitoring Solapur Sanitation Workers</p>
            </div>

            <div class="header-controls">
                <div class="search-bar">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="#bdc3c7" stroke-width="2"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
                    <input type="text" placeholder="Search Worker ID or Zone...">
                </div>
                <button class="btn-icon" onclick="toggleWeather()">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#2c3e50" stroke-width="2"><path d="M12 2v2M12 20v2M4.93 4.93l1.41 1.41M17.66 17.66l1.41 1.41M2 12h2M20 12h2M6.34 17.66l-1.41 1.41M19.07 4.93l-1.41 1.41"/></svg>
                </button>
                <button class="btn-icon">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#2c3e50" stroke-width="2"><path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"></path><path d="M13.73 21a2 2 0 0 1-3.46 0"></path></svg>
                    <div class="badge">3</div>
                </button>
                <div class="user-profile">
                    <img src="https://picsum.photos/seed/official/100/100" alt="Officer" class="avatar">
                    <div class="user-info">
                        <strong>Rajesh Deshmukh</strong>
                        <span>Chief Officer</span>
                    </div>
                </div>
            </div>
        </header>

        <!-- CONTENT -->
        <main class="content">
            
            <!-- KPI ROW -->
            <div class="kpi-row">
                <div class="card">
                    <div class="card-icon-bg"></div>
                    <div class="card-content">
                        <div class="card-title">Active Workers</div>
                        <div class="card-value">1,248</div>
                        <div class="card-trend trend-up">
                            <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><polyline points="23 6 13.5 15.5 8.5 10.5 1 18"></polyline><polyline points="17 6 23 6 23 12"></polyline></svg>
                            12% vs yesterday
                        </div>
                    </div>
                </div>
                <div class="card">
                    <div class="card-icon-bg"></div>
                    <div class="card-content">
                        <div class="card-title">Safety Index</div>
                        <div class="card-value">94.2%</div>
                        <div class="card-trend trend-up">
                            <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><polyline points="23 6 13.5 15.5 8.5 10.5 1 18"></polyline><polyline points="17 6 23 6 23 12"></polyline></svg>
                            Stable
                        </div>
                    </div>
                </div>
                <div class="card">
                    <div class="card-icon-bg"></div>
                    <div class="card-content">
                        <div class="card-title">Critical Alerts</div>
                        <div class="card-value" style="color: var(--danger)">2</div>
                        <div class="card-trend trend-down">
                            Action Required
                        </div>
                    </div>
                </div>
                <div class="card">
                    <div class="card-icon-bg"></div>
                    <div class="card-content">
                        <div class="card-title">Waste Processed</div>
                        <div class="card-value">450 T</div>
                        <div class="card-trend trend-up">
                            Daily Target Met
                        </div>
                    </div>
                </div>
            </div>

            <!-- LIVE MAP -->
            <section class="map-section">
                <div class="section-header">
                    <div class="section-title">Live Worker Tracking (Solapur City)</div>
                    <div class="map-controls">
                        <button class="map-btn active">Map View</button>
                        <button class="map-btn">Satellite</button>
                        <button class="map-btn">Heatmap</button>
                    </div>
                </div>
                <!-- Custom Canvas Map -->
                <div id="cityMap">
                    <div class="map-tooltip" id="mapTooltip"></div>
                </div>
            </section>

            <!-- SIDE PANEL (Health & Feeds) -->
            <aside class="side-panel">
                <!-- Health Monitor -->
                <div class="health-monitor">
                    <div class="section-header">
                        <div class="section-title">Worker Vitals (Live)</div>
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#00d2d3" stroke-width="2"><path d="M22 12h-4l-3 9L9 3l-3 9H2"/></svg>
                    </div>
                    <div class="worker-list" id="workerList">
                        <!-- Populated by JS -->
                    </div>
                </div>

                <!-- Video Wall -->
                <div class="video-wall">
                    <div class="section-header">
                        <div class="section-title">Bodycam & CCTV</div>
                        <span style="font-size:0.7rem; color:var(--success);">● LIVE</span>
                    </div>
                    <div class="video-grid">
                        <div class="video-feed">
                            <img src="https://picsum.photos/seed/cam1/300/200" alt="Feed 1">
                            <div class="rec-badge"><div class="rec-dot"></div> REC</div>
                            <div class="cam-label">Siddheshwar Rd.</div>
                        </div>
                        <div class="video-feed">
                            <img src="https://picsum.photos/seed/cam2/300/200" alt="Feed 2">
                            <div class="rec-badge"><div class="rec-dot"></div> REC</div>
                            <div class="cam-label">Market Zone</div>
                        </div>
                        <div class="video-feed">
                            <img src="https://picsum.photos/seed/cam3/300/200" alt="Feed 3">
                            <div class="rec-badge"><div class="rec-dot"></div> REC</div>
                            <div class="cam-label">Garbage Truck #4</div>
                        </div>
                        <div class="video-feed">
                            <img src="https://picsum.photos/seed/cam4/300/200" alt="Feed 4">
                            <div class="rec-badge"><div class="rec-dot"></div> REC</div>
                            <div class="cam-label">Kalamba Area</div>
                        </div>
                    </div>
                </div>
            </aside>

            <!-- INCIDENT TABLE -->
            <section class="incident-panel">
                <div class="section-header">
                    <div class="section-title">Recent Incident Reports</div>
                    <button class="map-btn">View All</button>
                </div>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Time</th>
                                <th>Location</th>
                                <th>Worker</th>
                                <th>Issue Type</th>
                                <th>Status</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody id="incidentTableBody">
                            <!-- Populated by JS -->
                        </tbody>
                    </table>
                </div>
                
                <!-- Simple SVG Chart Visualization within the panel -->
                <div class="chart-container" id="chartContainer">
                    <!-- SVG inserted by JS -->
                </div>
            </section>

        </main>
    </div>

    <!-- TOAST CONTAINER -->
    <div class="toast-container" id="toastContainer"></div>

    <script>
        /* =========================================
           UTILITY FUNCTIONS & DATA
           ========================================= */
        
        const workers = [
            { id: 'W-101', name: 'Amit Patil', zone: 'Siddheshwar', hr: 78, o2: 98, status: 'normal' },
            { id: 'W-102', name: 'Sunita K', zone: 'Kalamba', hr: 110, o2: 95, status: 'critical' },
            { id: 'W-103', name: 'Raju Shinde', zone: 'Railway Stn', hr: 72, o2: 99, status: 'normal' },
            { id: 'W-104', name: 'Meena Devi', zone: 'Market', hr: 85, o2: 97, status: 'warning' },
            { id: 'W-105', name: 'Vikram S', zone: 'Fort Area', hr: 70, o2: 99, status: 'normal' },
        ];

        const incidents = [
            { id: 'INC-2049', time: '10:42 AM', loc: 'Siddheshwar Rd', worker: 'Amit Patil', type: 'Equipment Fail', status: 'Resolved' },
            { id: 'INC-2050', time: '11:15 AM', loc: 'Kalamba Zone', worker: 'Sunita K', type: 'High Heart Rate', status: 'Critical' },
            { id: 'INC-2051', time: '11:30 AM', loc: 'Market', worker: 'Meena Devi', type: 'Obstruction', status: 'Pending' },
        ];

        const solapurZones = [
            { name: "Siddheshwar Nagar", x: 200, y: 150, w: 150, h: 100 },
            { name: "Kalamba", x: 400, y: 200, w: 120, h: 120 },
            { name: "Railway Station", x: 250, y: 350, w: 180, h: 80 },
            { name: "Old Fort", x: 600, y: 100, w: 100, h: 100 },
            { name: "Market", x: 550, y: 300, w: 140, h: 110 }
        ];

        /* =========================================
           INITIALIZATION & LOADER
           ========================================= */
        window.addEventListener('load', () => {
            setTimeout(() => {
                const loader = document.getElementById('loader');
                const app = document.getElementById('app');
                
                loader.style.opacity = '0';
                loader.style.visibility = 'hidden';
                
                app.classList.add('loaded');
                
                // Start Systems
                initMap();
                initWorkerList();
                initIncidentTable();
                initChart();
                startDataSimulation();
                showToast('System', 'Connected to Solapur Municipal Corp Server', 'normal');
            }, 2000);
        });

        /* =========================================
           WORKER LIST LOGIC
           ========================================= */
        function initWorkerList() {
            const list = document.getElementById('workerList');
            list.innerHTML = '';
            
            workers.forEach(w => {
                const hrClass = w.hr > 100 || w.hr < 60 ? 'heart-icon' : '';
                const hrStyle = w.hr > 100 ? 'color: var(--danger)' : '';
                
                const item = document.createElement('div');
                item.className = 'worker-item';
                item.innerHTML = `
                    <div class="w-info">
                        <img src="https://picsum.photos/seed/${w.id}/100/100" class="w-img" alt="Worker">
                        <div class="w-details">
                            <h5>${w.name}</h5>
                            <span>${w.id} • ${w.zone}</span>
                        </div>
                    </div>
                    <div class="vitals">
                        <div class="vital-row" style="${hrStyle}">
                            <svg class="${hrClass}" width="14" height="14" viewBox="0 0 24 24" fill="currentColor" stroke="none"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg>
                            ${w.hr} BPM
                        </div>
                        <div class="vital-row">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"/></svg>
                            ${w.o2}%
                        </div>
                    </div>
                `;
                list.appendChild(item);
            });
        }

        /* =========================================
           INCIDENT TABLE LOGIC
           ========================================= */
        function initIncidentTable() {
            const tbody = document.getElementById('incidentTableBody');
            tbody.innerHTML = '';
            
            incidents.forEach(inc => {
                let statusClass = 'status-resolved';
                if(inc.status === 'Critical') statusClass = 'status-critical';
                if(inc.status === 'Pending') statusClass = 'status-warning';
                
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${inc.id}</td>
                    <td>${inc.time}</td>
                    <td>${inc.loc}</td>
                    <td>${inc.worker}</td>
                    <td>${inc.type}</td>
                    <td><span class="status-pill ${statusClass}">${inc.status}</span></td>
                    <td><button class="map-btn">Details</button></td>
                `;
                tbody.appendChild(tr);
            });
        }

        /* =========================================
           CANVAS MAP ENGINE
           ========================================= */
        let mapCanvas, mapCtx, animationFrame;
        const workersOnMap = [];

        function initMap() {
            const container = document.getElementById('cityMap');
            mapCanvas = document.createElement('canvas');
            mapCtx = mapCanvas.getContext('2d');
            container.appendChild(mapCanvas);

            // Resize handling
            const resize = () => {
                mapCanvas.width = container.offsetWidth;
                mapCanvas.height = container.offsetHeight;
            };
            window.addEventListener('resize', resize);
            resize();

            // Initialize map points (workers)
            workers.forEach((w, i) => {
                // Assign random positions near zones
                const zone = solapurZones[i % solapurZones.length];
                workersOnMap.push({
                    x: zone.x + Math.random() * zone.w,
                    y: zone.y + Math.random() * zone.h,
                    vx: (Math.random() - 0.5) * 0.5, // Velocity X
                    vy: (Math.random() - 0.5) * 0.5, // Velocity Y
                    id: w.id,
                    name: w.name,
                    status: w.status,
                    color: w.status === 'critical' ? '#ff6b6b' : '#0056b3'
                });
            });

            animateMap();
        }

        function animateMap() {
            const w = mapCanvas.width;
            const h = mapCanvas.height;
            
            // Clear
            mapCtx.clearRect(0, 0, w, h);

            // Draw Grid (Map Background)
            mapCtx.strokeStyle = '#e0e6ed';
            mapCtx.lineWidth = 1;
            mapCtx.beginPath();
            for(let x=0; x<w; x+=40) { mapCtx.moveTo(x,0); mapCtx.lineTo(x,h); }
            for(let y=0; y<h; y+=40) { mapCtx.moveTo(0,y); mapCtx.lineTo(w,y); }
            mapCtx.stroke();

            // Draw Zones (Abstract Shapes)
            mapCtx.fillStyle = 'rgba(255, 255, 255, 0.6)';
            mapCtx.strokeStyle = '#cbd5e0';
            mapCtx.lineWidth = 2;
            
            solapurZones.forEach(z => {
                // Scale zones to fit canvas
                const zx = (z.x / 800) * w;
                const zy = (z.y / 500) * h;
                const zw = (z.w / 800) * w;
                const zh = (z.h / 500) * h;

                mapCtx.fillRect(zx, zy, zw, zh);
                mapCtx.strokeRect(zx, zy, zw, zh);
                
                // Zone Labels
                mapCtx.fillStyle = '#7f8c8d';
                mapCtx.font = '10px Arial';
                mapCtx.fillText(z.name, zx + 5, zy + 15);
                mapCtx.fillStyle = 'rgba(255, 255, 255, 0.6)';
            });

            // Update and Draw Workers
            workersOnMap.forEach(p => {
                // Move
                p.x += p.vx;
                p.y += p.vy;

                // Bounce off walls
                if(p.x < 5 || p.x > w - 5) p.vx *= -1;
                if(p.y < 5 || p.y > h - 5) p.vy *= -1;

                // Draw Ripple for Critical
                if(p.status === 'critical') {
                    mapCtx.beginPath();
                    mapCtx.arc(p.x, p.y, 10 + Math.sin(Date.now()/200)*5, 0, Math.PI*2);
                    mapCtx.strokeStyle = `rgba(255, 107, 107, 0.5)`;
                    mapCtx.stroke();
                }

                // Draw Worker Dot
                mapCtx.beginPath();
                mapCtx.arc(p.x, p.y, 6, 0, Math.PI * 2);
                mapCtx.fillStyle = p.color;
                mapCtx.fill();
                
                // Label on hover logic could go here, kept simple for performance
            });

            animationFrame = requestAnimationFrame(animateMap);
        }

        /* =========================================
           CHART ENGINE (SVG)
           ========================================= */
        function initChart() {
            const container = document.getElementById('chartContainer');
            const data = [10, 25, 18, 40, 35, 60, 55, 80, 70, 95]; // Incident trend
            const w = container.offsetWidth;
            const h = container.offsetHeight;
            const padding = 20;
            
            const maxVal = 100;
            const points = data.map((val, idx) => {
                const x = (idx / (data.length - 1)) * (w - padding * 2) + padding;
                const y = h - ((val / maxVal) * (h - padding * 2)) - padding;
                return `${x},${y}`;
            }).join(' ');

            const svg = `
                <svg width="100%" height="100%" viewBox="0 0 ${w} ${h}" preserveAspectRatio="none">
                    <defs>
                        <linearGradient id="chartGrad" x1="0%" y1="0%" x2="0%" y2="100%">
                            <stop offset="0%" style="stop-color:var(--primary);stop-opacity:0.3" />
                            <stop offset="100%" style="stop-color:var(--primary);stop-opacity:0" />
                        </linearGradient>
                    </defs>
                    <polyline points="${padding},${h-padding} ${points} ${w-padding},${h-padding}" class="chart-area" fill="url(#chartGrad)" />
                    <polyline points="${points}" class="chart-line" />
                    <circle cx="${(data.length-1)/(data.length-1)*(w-padding*2)+padding}" cy="${h - ((data[data.length-1]/maxVal)*(h-padding*2))-padding}" r="4" fill="var(--primary)" stroke="white" stroke-width="2"/>
                </svg>
            `;
            
            container.innerHTML = svg;
        }

        /* =========================================
           SIMULATION LOOP (Live Updates)
           ========================================= */
        function startDataSimulation() {
            // Randomly update Heart Rates
            setInterval(() => {
                workers.forEach(w => {
                    const change = Math.floor(Math.random() * 10) - 5;
                    w.hr = Math.max(60, Math.min(140, w.hr + change));
                    
                    // Randomly trigger critical
                    if(Math.random() > 0.98) {
                        w.hr = 130;
                        w.status = 'critical';
                        showToast('SOS Alert', `${w.name} (${w.id}) critical vitals detected!`, 'danger');
                    } else if (w.hr < 100 && w.status === 'critical') {
                         w.status = 'normal';
                    }
                });
                initWorkerList();
            }, 3000);

            // Random Toast Notification
            setInterval(() => {
                if(Math.random() > 0.9) {
                    const msgs = [
                        { t: 'Info', m: 'Garbage Truck #4 reached disposal site', type: 'normal' },
                        { t: 'Warning', m: 'High traffic reported near Market Zone', type: 'warning' },
                        { t: 'System', m: 'Data sync completed successfully', type: 'normal' }
                    ];
                    const msg = msgs[Math.floor(Math.random() * msgs.length)];
                    showToast(msg.t, msg.m, msg.type);
                }
            }, 8000);
        }

        /* =========================================
           TOAST NOTIFICATION SYSTEM
           ========================================= */
        function showToast(title, message, type) {
            const container = document.getElementById('toastContainer');
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            
            let icon = '';
            if(type === 'danger') icon = '<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#ff6b6b" stroke-width="2"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path><line x1="12" y1="9" x2="12" y2="13"></line><line x1="12" y1="17" x2="12.01" y2="17"></line></svg>';
            else if(type === 'warning') icon = '<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#feca57" stroke-width="2"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="8" x2="12" y2="12"></line><line x1="12" y1="16" x2="12.01" y2="16"></line></svg>';
            else icon = '<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#0056b3" stroke-width="2"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path><polyline points="22 4 12 14.01 9 11.01"></polyline></svg>';

            toast.innerHTML = `
                <div class="toast-icon">${icon}</div>
                <div class="toast-content">
                    <h4>${title}</h4>
                    <p>${message}</p>
                </div>
            `;
            
            container.appendChild(toast);

            // Remove after 4 seconds
            setTimeout(() => {
                toast.style.animation = 'slideOutToast 0.5s forwards';
                toast.addEventListener('animationend', () => {
                    toast.remove();
                });
            }, 4000);
        }

        function toggleWeather() {
            showToast('Weather Update', 'Solapur: 34°C, Humidity 45%. Suitable for work.', 'normal');
        }

    </script>
</body>
</html>